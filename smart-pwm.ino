#include <vector>

#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define OUTPUT_PIN 2
#define POTENTIO_PIN 4
#define BUTTON_BACK_PIN 16
#define BUTTON_OK_PIN 17
#define BUTTON_NEXT_PIN 18
#define BUZZER_PIN 15
#define SCREEN_WIDTH 128 // OLED width,  in pixels
#define SCREEN_HEIGHT 64 // OLED height, in pixels
#define I2C_ADDRESS 0x3C // I2C address, depends on specs

#define VCC 3.3
#define EXPECTED_VOUT 2.0
#define INPUT_RANGE 255.0
#define EXPECTED_IOUT 0.008

unsigned long previousDimMillis = 0;
unsigned long dimInterval = 100; // Interval for dimming in milliseconds

Adafruit_SSD1306 oled(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);

class ResourceUsage
{
public:
    ResourceUsage()
    {
        voltage = 0;
        resistance = 0;
        current = 0;
        power = 0;
    }

    float store(float input)
    {
        voltage = input / INPUT_RANGE * VCC;
        resistance = (VCC - EXPECTED_VOUT) / EXPECTED_IOUT;
        current = voltage / resistance;
        power = voltage * current;

        return input;
    }

    float getVoltage()
    {
        return voltage;
    }

    float getResistance()
    {
        return resistance;
    }

    float getCurrent()
    {
        return current;
    }

    float getPower()
    {
        return power;
    }

private:
    float voltage;
    float resistance;
    float current;
    float power;
};

ResourceUsage usage;

class Button
{                                             // a simple class for buttons based on the "Debounce" example
    const byte buttonPin;                     // the GPIO / pin for the button
    static constexpr byte debounceDelay = 30; // the debounce time; increase if the output flickers. Static because we only need one value for all buttons
    const bool active;                        // is the pin active HIGH or active LOW (will also activate the pullups!)
    const int freq;                           // is the frequency will be used in the buzzer
    bool lastButtonState = HIGH;              // the previous reading from the input pin
    byte lastDebounceTime = 0;                // the last time the output pin was toggled - we check only ONE byte, so I didn't mess around with unsigned long

public:
    /**
       \brief constructor for a button

       The constructor takes the GPIO as parameter.
       If you omit the second parameter, the library will activate the internal pullup resistor
       and the button should connect to GND.
       If you set the second parameter to HIGH, the button is active HIGH.
       The button should connect to VCC.
       The internal pullups will not be used but you will need an external pulldown resistor.

       \param attachTo the GPIO for the button
       \param active LOW (default) - if button connects to GND, HIGH if button connects to VCC
    */
    Button(byte attachTo, long freq = 3000, bool active = LOW) : buttonPin(attachTo), freq(freq), active(active) {}

    /**
       \brief set the pin to the proper state

       Call this function in your setup().
       The pinMode will be set according to your constructor.
    */
    void begin()
    {
        if (active == LOW)
            pinMode(buttonPin, INPUT);
        else
            pinMode(buttonPin, INPUT_PULLUP);
    }

    void beep()
    {
        tone(BUZZER_PIN, freq, 75);
    }

    /**
        \brief indicate if button was pressed since last call

        @return HIGH if button was pressed since last call - debounce
    */
    bool wasPressed()
    {
        bool buttonState = LOW; // the current reading from the input pin
        byte reading = LOW;     // "translated" state of button LOW = released, HIGH = pressed, despite the electrical state of the input pint
        if (digitalRead(buttonPin) == active)
            reading = HIGH;                                         // if we are using INPUT_PULLUP we are checking invers to LOW Pin
        if (((millis() & 0xFF) - lastDebounceTime) > debounceDelay) // If the switch changed, AFTER any pressing or noise
        {
            if (reading != lastButtonState && lastButtonState == LOW) // If there was a change and and last state was LOW (= released)
            {
                buttonState = HIGH;
                beep();
            }
            lastDebounceTime = millis() & 0xFF;
            lastButtonState = reading;
        }
        return buttonState;
    }
};

Button buttonBack{BUTTON_BACK_PIN, 3000};
Button buttonOK{BUTTON_OK_PIN, 2000};
Button buttonNext{BUTTON_NEXT_PIN, 3000};

class OLEDModule
{
public:
    OLEDModule() {}

    static const char batteryIconLowBitmap[];
    static const char batteryIconMediumBitmap[];
    static const char batteryIconHighBitmap[];
    static const char batteryIconFullBitmap[];

    void begin()
    {
        if (!oled.begin(SSD1306_SWITCHCAPVCC, I2C_ADDRESS))
        {
            Serial.println(F("Failed to start SSD1306 OLED"));
            while (1)
                ;
        }
        displayLogo();
        delay(2000);
        displayMenu();
    }

    void displayLogo()
    {
        selectedPage = "Logo";

        const unsigned char logoBitmap[] PROGMEM = {
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf9, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x06, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x03, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x80,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00,
            0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,
            0xe0, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0,
            0x21, 0xe0, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x80, 0x00, 0xe0, 0x30, 0x1f, 0xf9, 0xfc, 0x00, 0xc0, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x80, 0x06, 0x00, 0x10, 0x1f, 0xf9, 0xff, 0x01, 0xe0, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x01, 0x00, 0x0f, 0x00, 0x10, 0x01, 0x81, 0x83, 0x81, 0xe0, 0x61, 0x80, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x01, 0x00, 0x07, 0x00, 0x18, 0x01, 0x81, 0x81, 0x83, 0xf0, 0x61, 0x80, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x01, 0x00, 0x02, 0x40, 0x08, 0x01, 0x81, 0x81, 0x83, 0x30, 0x61, 0x80, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x60, 0xe0, 0x08, 0x01, 0x81, 0x81, 0x83, 0x30, 0x61, 0x80,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xf0, 0xe0, 0x08, 0x01, 0x81, 0xc7, 0x86, 0x18, 0x61,
            0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x70, 0x40, 0x08, 0x01, 0x81, 0xff, 0x06, 0x18,
            0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x06, 0x40, 0x08, 0x01, 0x81, 0xee, 0x0f,
            0xfc, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x0f, 0x40, 0x18, 0x01, 0x81, 0x86,
            0x0f, 0xfc, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x06, 0x40, 0x10, 0x01, 0x81,
            0x87, 0x1c, 0x0e, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x40, 0x10, 0x01,
            0x81, 0x83, 0x98, 0x06, 0x61, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 0x40, 0x30,
            0x1f, 0xff, 0x81, 0xf0, 0x07, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xff, 0xc0,
            0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x60,
            0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20,
            0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x30, 0x00, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x18, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x06, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x03, 0x80, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

        oled.clearDisplay();

        int logoWidth = 135;
        int logoHeight = 135;

        int centerX = (SCREEN_WIDTH - logoWidth) / 2;
        int centerY = (SCREEN_HEIGHT - logoHeight) / 2;

        oled.drawBitmap(centerX, centerY, logoBitmap, logoWidth, logoHeight, 1);
        oled.display();
    }

    void error(String message)
    {
        oled.clearDisplay();
        oled.println(message);
    }

    void commonDisplay()
    {
        if (selectedPage == "Logo")
        {
            handleLogo();
        };
        if (selectedPage == "Menu")
        {
            handleMenu();
        };
        if (selectedPage == "Resource")
        {
            handleResource();
        };
        if (selectedPage == "Battery")
        {
            handleBattery();
        };
    }

    void displayMenu()
    {
        selectedPage = "Menu";

        oled.clearDisplay();
        oled.setTextSize(1);
        oled.setTextColor(WHITE);
        oled.setCursor(0, 2);

        for (int i = 0; i < menuOptions.size(); i++)
        {
            if (i == selectedOption)
            {
                oled.print("> "); // Display ">" for the selected option
            }
            else
            {
                oled.print("  "); // Display a space for other options
            }
            oled.println(menuOptions[i]);
        }

        oled.display();
    }

    void handleMenu()
    {
        if (buttonBack.wasPressed())
        {
            selectedOption = (selectedOption - 1 + menuOptions.size()) % menuOptions.size();
            displayMenu();
        }
        if (buttonOK.wasPressed())
        {
            switch (selectedOption)
            {
            case 0:
                displayResources();
                break;
            case 1:
                // TODO: display real battery capacity
                displayBattery(100);
                break;
            case 2:
                displayLogo();
                break;
            default:
                error("unknown selected menu: " + String(selectedOption));
            }
        }
        if (buttonNext.wasPressed())
        {
            selectedOption = (selectedOption + 1) % menuOptions.size();
            displayMenu();
        }
    }

    void handleLogo()
    {
        if (buttonBack.wasPressed())
        {
        }
        if (buttonOK.wasPressed())
        {
            displayMenu();
        }
        if (buttonNext.wasPressed())
        {
        }
    }

    void handleResource()
    {
        if (buttonBack.wasPressed())
        {
            displayMenu();
        }
        if (buttonOK.wasPressed())
        {
        }
        if (buttonNext.wasPressed())
        {
        }
    }

    void handleBattery()
    {
        if (buttonBack.wasPressed())
        {
            displayMenu();
        }
        if (buttonOK.wasPressed())
        {
        }
        if (buttonNext.wasPressed())
        {
        }
    }

    void displayBattery(int battery)
    {
        selectedPage = "Battery";

        oled.clearDisplay();
        oled.setTextSize(1);
        oled.setTextColor(WHITE);

        // Determine the battery icon based on the battery percentage
        const uint8_t *batteryIcon;
        if (battery < 25)
        {
            batteryIcon = reinterpret_cast<const uint8_t *>(batteryIconLowBitmap);
        }
        else if (battery < 50)
        {
            batteryIcon = reinterpret_cast<const uint8_t *>(batteryIconMediumBitmap);
        }
        else if (battery < 75)
        {
            batteryIcon = reinterpret_cast<const uint8_t *>(batteryIconHighBitmap);
        }
        else
        {
            batteryIcon = reinterpret_cast<const uint8_t *>(batteryIconFullBitmap);
        }

        int iconWidth = 51;  // Width of the battery icon
        int iconHeight = 51; // Height of the battery icon

        // Calculate X and Y positions to center the icon and text
        int centerX = (SCREEN_WIDTH - iconWidth) / 2;

        // Display the battery icon
        oled.drawBitmap(centerX, 0, batteryIcon, iconWidth, iconHeight, 1);

        // Display battery percentage
        String message = "Battery: " + String(battery) + "%";
        int textCharLength = message.length();
        oled.setCursor(centerX - textCharLength, 1 + iconHeight);
        oled.println(message);

        oled.display();
    }

    void displayResources()
    {
        selectedPage = "Resource";

        oled.clearDisplay();
        oled.setTextSize(1);
        oled.setTextColor(WHITE);
        oled.setCursor(0, 2);

        oled.print("Power (W): ");
        oled.println(ru.getPower());
        oled.print("Current (mA): ");
        oled.println(ru.getCurrent() * 1000);
        oled.print("Resistance (Ohm): ");
        oled.println(ru.getResistance());
        oled.print("Voltage (V): ");
        oled.println(ru.getVoltage());

        oled.display();
    }

    void setUsage(ResourceUsage usage)
    {
        ru = usage;
    }

private:
    int selectedOption;
    String selectedPage;
    ResourceUsage ru;
    std::vector<String> menuOptions = {
        "Resource Usages",
        "Check Battery",
        "Back",
    };
};

OLEDModule oledmod;

// Define the icon bitmaps as const char* arrays
const char OLEDModule::batteryIconLowBitmap[] = {
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xe0, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xe0, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x60,
    0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x38, 0x00,
    0xff, 0xff, 0xff, 0xfc, 0x60, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x38, 0x00, 0xff, 0xff,
    0xff, 0xfc, 0x60, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x20, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc,
    0x00, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x38,
    0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x38, 0x00, 0xff,
    0xff, 0xff, 0xfc, 0x00, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x38, 0x00, 0xff, 0xff, 0xff,
    0xfc, 0x20, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x60,
    0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x38, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x38, 0x00,
    0xff, 0xff, 0xff, 0xfc, 0x60, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x1f, 0xff, 0xff, 0xff,
    0xff, 0xfc, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01,
    0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xe0};

const char OLEDModule::batteryIconMediumBitmap[] = {
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xe0, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xe0, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x60,
    0x38, 0x00, 0x00, 0x7f, 0xff, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc, 0x60, 0x38, 0x00,
    0x00, 0x3f, 0xff, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x7f, 0xff, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x3f,
    0xff, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x7f, 0xff, 0xfc, 0x20, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc,
    0x00, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc, 0x00, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc, 0x00, 0x38,
    0x00, 0x00, 0x3f, 0xff, 0xfc, 0x00, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc, 0x00, 0x38, 0x00, 0x00,
    0x3f, 0xff, 0xfc, 0x00, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc, 0x00, 0x38, 0x00, 0x00, 0x3f, 0xff,
    0xfc, 0x20, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc, 0x60,
    0x38, 0x00, 0x00, 0x7f, 0xff, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x3f, 0xff, 0xfc, 0x60, 0x38, 0x00,
    0x00, 0x7f, 0xff, 0xfc, 0x60, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x1f, 0xff, 0xff, 0xff,
    0xff, 0xfc, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01,
    0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xe0};

const char OLEDModule::batteryIconHighBitmap[] = {
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xe0, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xe0, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x60,
    0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x60, 0x38, 0x00,
    0x00, 0x00, 0x1f, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x00,
    0x1f, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x20, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc,
    0x00, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x00, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x00, 0x38,
    0x00, 0x00, 0x00, 0x1f, 0xfc, 0x00, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x00, 0x38, 0x00, 0x00,
    0x00, 0x1f, 0xfc, 0x00, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x00, 0x38, 0x00, 0x00, 0x00, 0x1f,
    0xfc, 0x20, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x60,
    0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x60, 0x38, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x60, 0x38, 0x00,
    0x00, 0x00, 0x1f, 0xfc, 0x60, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x1f, 0xff, 0xff, 0xff,
    0xff, 0xfc, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01,
    0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xe0};

const char OLEDModule::batteryIconFullBitmap[] = {
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xe0, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xe0, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x60,
    0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x60, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x60, 0x38, 0x00,
    0x00, 0x00, 0x00, 0x0c, 0x60, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x60, 0x38, 0x00, 0x00, 0x00,
    0x00, 0x0c, 0x60, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x20, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c,
    0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x38,
    0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x38, 0x00, 0x00,
    0x00, 0x00, 0x0c, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00,
    0x0c, 0x20, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x60, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x60,
    0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x60, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x60, 0x38, 0x00,
    0x00, 0x00, 0x00, 0x0c, 0x60, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x60, 0x1f, 0xff, 0xff, 0xff,
    0xff, 0xfc, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01,
    0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xe0};

void dim()
{
    float potentiometerValue = map(analogRead(POTENTIO_PIN), 0, 4095, 0, 255);
    usage.store(potentiometerValue);
    oledmod.setUsage(usage);
    analogWrite(OUTPUT_PIN, potentiometerValue);
}

void monitor(int interval)
{
    static long next_time = 0;
    if (millis() < next_time)
        return;
    next_time += interval;
    oledmod.commonDisplay();
}

void output(int interval)
{
    static long next_time = 0;
    if (millis() < next_time)
        return;
    next_time += interval;
    dim();
}

void setup()
{
    Serial.begin(115200);

    pinMode(OUTPUT_PIN, OUTPUT);
    pinMode(POTENTIO_PIN, INPUT);

    pinMode(BUZZER_PIN, OUTPUT);
    digitalWrite(BUZZER_PIN, LOW);

    buttonBack.begin();

    oledmod.begin();
}

void loop()
{
    monitor(1); // schedule the two protothreads
    output(1);  // by calling them infinitely
}
